# shellcheck shell=bash

if ! has nix_direnv_version || ! nix_direnv_version 3.0.4; then
  source_url \
    "https://raw.githubusercontent.com/nix-community/nix-direnv/3.0.4/direnvrc" \
    "sha256-DzlYZ33mWF/Gs8DDeyjr8mnVmQGx7ASYqA5WlxwvBG4="
fi

use flake
watch_file ./flake-modules/dev-shell.nix

yellow='\e[33m'
reset='\e[m'
secrets_directory='./secrets'
github_file="$secrets_directory/github.txt"
if [ -f "$github_file" ]; then
  NIX_CONFIG="access-tokens = github.com=$(cat "$github_file")"
  export NIX_CONFIG
else
  echo -e "[${yellow}warning${reset}] secret '$github_file' was not found"
fi

printf "\n[just]\n%s\n\n" "$(just help)"
